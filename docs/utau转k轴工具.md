# openutau 转 .ass(k轴) 工具(uta)

使用 `voices uta -i <src> -o <des>` 指令来启动脚本，或在脚本中自行输入 `<src>` 或 `<des>`，随后根据脚本的提示修改配置项后即可开始切片。

- `--input(-i)`: 输入路径 `<src>`，也就是需要处理的文件。
- `--output(-o)`: 输出路径 `<des>`，也就是处理后输出的文件。

同时，你也可以添加此几项可选参数：

- `--track(-t)`: 使用的 ustx 轨道名，留空则使用第一轨道
- `--lyrics(-l)`: 歌词文件，详见下文[使用歌词文件](#使用歌词文件)
- `--perset`: 每行字幕的“前摇”，设置后将会在每行字幕前额外添加一个空值，单位为毫秒(ms)。
- `--offset`: 每行字幕的“后摇”，设置后将会在每行字幕后额外添加一个空值，单位为毫秒(ms)。

注意，脚本分行的依据是 openutau 项目文件中的断字进行区分，并将句中的 `AP` `SP` 替换为空格，忽略句首的 `AP` `SP`，将 `+` 的时长拼接至上一字。

## 使用歌词文件

`voices uta -i <src> -l <lyrics> -o <des>`

添加此选项后，脚本会使用歌词文件中的文字进行转换，并按照歌词文件进行断句。例如：

```text
于你的生命之中红与蓝的线缠绕交错
在心间划上最后一笔勾勒出你的脉络
```

对应的输出为：

```text
Dialogue: 0,0:00:38.46,0:00:43.46,Default,None,0,0,0,,{\k38}于{\k38}{\k57}你{\k19}的{\k19}生{\k19}命{\k38}之{\k38}中{\k19}红{\k19}与{\k38}蓝{\k19}的{\k19}线{\k38}缠{\k19}绕{\k19}交{\k38}错
Dialogue: 0,0:00:44.61,0:00:49.61,Default,None,0,0,0,,{\k38}在{\k38}{\k57}心{\k19}间{\k19}划{\k19}上{\k38}最{\k38}后{\k19}一{\k19}笔{\k38}勾{\k19}勒{\k19}出{\k38}你{\k19}的{\k19}脉{\k38}络
```

输出会完全按照歌词文件进行断句和替换，但有以下几点需要注意：

1. 歌词文件应该是纯文本，不包括任何**标点符号**和**空格**
2. 目前是逐字比对，在英语、日语假名、拼音等**非一对一类型的文本**上极有可能出现问题（但可以手动替换此部分，确保其与ustx文件一一对应，并在生成的ass文件中手动改回来）
3. 请确保ustx轨道中的文字数（去除 AP、SP、+ 之后的note数）和歌词文件中文字数的**字数一致**，否则可能会出现对齐错误或程序报错(`IndexError`)
